# Progress Log

## Learnings
Read this first each iteration.

---

## Bug Fix Summary (Session 8)

### Critical Fixes (Claude-1)
- **Infinite recursion in getAbsolutePosition**: Added visited Set for cycle detection in parent chain traversal
- **Race condition in file drop handling**: Refactored to use Promise.all() instead of async callbacks
- **Memory leak in collaboration timeout**: Clear disconnectionToastTimeout on reconnect
- **Event handler order in file loading**: Set onerror/onload handlers before src property
- **Unsafe type cast**: Added type guard for FileReader result

### Error Handling (Claude-2)
- **Sync failure handling**: Added error handling for WebSocket provider sync events
- **Failed image cache cleanup**: Remove failed images from cache on onerror
- **Bounds validation in snap utils**: Guard against Infinity/NaN from extreme dimensions
- **Bounds check in zoomToFit**: Guard division when width/height is zero
- **Error logging safety**: Use optional chaining for obj.id in error logs

### Edge Cases (Claude-3)
- **Rotation normalization**: Normalize with `(rotation % 360) * Math.PI / 180` to prevent floating point issues
- **Floating point epsilon check**: Added epsilon check `maxPointX > 0.001` for path scaling
- **RAF scheduling**: Confirmed safe - JS single-threaded model prevents race
- **Set iteration optimization**: Use `selectedIds.values().next().value` instead of Array.from

### Verification (Claude-4)
- Added tests for cyclic parent chain in groupStore
- Added tests for zero-dimension resize (skipped pending aspectRatio fix)
- Verified all fixes via code review
- Removed debug console.warn from clipboardStore

### Remaining Issues
- **Fix null dereference in drag move** (SelectTool.ts:475,501) - needs null check
- **Fix division by zero in resize** (SelectTool.ts:568) - guard width=0 case
